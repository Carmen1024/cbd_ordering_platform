var a=Object.defineProperty,t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,e,s)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;import{D as o,s as i,_ as n,o as c,d as r,w as u,e as d,L as f,f as m,F as p,T as g,h,k as _,U as y,E as v,G as C,R as I,N as b,O as P,Q as k,i as w,V as D,P as A}from"./vendor.a21c6627.js";import{r as S,m as j}from"./materialItem.07b22084.js";import{m as L,c as T,a as M,b as O,d as R}from"./subscribe.08568398.js";import{_ as x}from"./index.7ec11993.js";import"./request.bd165be5.js";import"./token.ba774510.js";const z=o({props:{countAndPrice:{type:Object,default:()=>({total:0,price:0})}},setup:a=>({}),methods:{toCart(){i({url:"/pages/tabBar/shoppingCart/shoppingCart"})}}});var B=n(o({components:{cart:n(z,[["render",function(a,t,e,s,l,o){const i=h,n=_,v=y;return c(),r(n,{class:"cart-container"},{default:u((()=>[d(n,{class:"account"},{default:u((()=>[d(n,{class:"left",onClick:a.toCart},{default:u((()=>[f("span",{class:"icon iconfont icon-goumai"}),a.countAndPrice.total&&a.countAndPrice.total>0?(c(),r(i,{key:0},{default:u((()=>[m(p(a.countAndPrice.total),1)])),_:1})):g("",!0)])),_:1},8,["onClick"]),d(n,{class:"right"},{default:u((()=>[a.countAndPrice.price&&a.countAndPrice.price>0?(c(),r(n,{key:0},{default:u((()=>[d(i,null,{default:u((()=>[m("总计:")])),_:1}),d(i,{class:"priceTotal"},{default:u((()=>[f("span",{class:"icon iconfont icon-jine"}),m(p(a.countAndPrice.price),1)])),_:1})])),_:1})):g("",!0),d(v,{type:"primary",size:"mini",onClick:a.toCart},{default:u((()=>[m("购物车")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e74e5d5a"]]),reaction:S,materialItem:j},onShow:function(){this.getCartCountAndPrice(),this.getCartList()},setup(){const a=v([]),o=v([]),i=v({}),n={pageSize:20,pageNum:1},c=v(0),r=v(0),u=v(!0),d=v(""),f=v([]),m=v([]);O({clf_inner_type:!0,clf_lay:1}).then((t=>{a.value=t.data}));const p=()=>{const a=((a,o)=>{for(var i in o||(o={}))e.call(o,i)&&l(a,i,o[i]);if(t)for(var i of t(o))s.call(o,i)&&l(a,i,o[i]);return a})({r_g_id:"10",s_id:"10"},n);L(a).then((a=>{console.log(m.value);const t=a.data.map((a=>{const t=m.value.find((t=>t.m_id===a._id));return console.log(t),a.num=t?t.m_c_count:0,a}));t.length<n.pageSize&&(u.value=!1),o.value=[...o.value,...t],n.pageNum++,setTimeout((()=>{_()}),100)}))},g=v({show:!1,materials:[]}),h=()=>{R({s_id:"10"}).then((a=>{i.value=a.data}))},_=()=>{f.value=a.value.map((a=>{const t="classify_"+a._id;return document.getElementById(t),document.getElementById(t)&&document.getElementById(t).offsetTop})).filter((a=>a)),console.log(f.value)};return{classifyData:a,materialData:o,scrollClassifyIndex:c,countAndPrice:i,getCartCountAndPrice:h,toCartInsert:a=>{T(a).then((a=>{var t;h();const e=null==(t=a.data)?void 0:t.r_m_material;e&&e.length>0?g.value={materials:e,show:!0}:g.value={materials:[],show:!1}}))},reactionMaterials:g,scrollTop:r,getMaterialQuery:p,loading:u,page:n,classifyDomId:d,topList:f,setTopList:_,getCartList:()=>{m.value=[],M({s_id:"10"}).then((a=>{m.value=a.data||[],c.value=0,r.value=0,u.value=!0,d.value="",f.value=[],o.value=[],n.pageNum=1,p()}))}}},methods:{classifyCheck(a,t){this.scrollClassifyIndex=t;const e=a._id,s="classify_"+e;if(document.getElementById(s))this.classifyDomId=s;else{const a={r_g_id:"10",s_id:"10",classifyId:e,lastMId:this.materialData[this.materialData.length-1]._id,pageSize:this.page.pageSize};L(a).then((a=>{const t=a.data.map((a=>(a.num=0,a)));t.length<this.page.pageSize&&(this.loading=!1),this.materialData=[...this.materialData,...t],this.page.pageNum=++a.pageNum,setTimeout((()=>{this.classifyDomId=s,this.setTopList()}),100)}))}},lower:function(a){console.log(a),this.loading&&this.getMaterialQuery()},scroll:function(a){const t=a.detail.scrollTop+10,e=this.topList;let s=null;for(let l=0;l<e.length;l++){const a=l+1;if((l==e.length-1&&t>e[l]||t>e[l]&&t<=e[a])&&(s=l,this.scrollClassifyIndex=l),s)break}},toSearch(){C({url:"/pages/tabBar/subscribe/search"})}}}),[["render",function(a,t,e,s,l,o){const i=w,n=h,g=_,y=I("material-item"),v=D,C=I("reaction"),S=I("cart");return c(),r(g,{class:"shopping-container"},{default:u((()=>[d(g,{class:"shopping-container-title"},{default:u((()=>[d(g,{class:"left"},{default:u((()=>[d(i,{class:"logo",src:x}),d(n,null,{default:u((()=>[m("茶百道双楠店")])),_:1})])),_:1}),d(g,{class:"right",onClick:a.toSearch},{default:u((()=>[f("span",{class:"icon iconfont icon-sousuo"}),m("搜索 ")])),_:1},8,["onClick"])])),_:1}),d(g,{class:"shopping-container-main"},{default:u((()=>[d(g,{class:"left classifyList"},{default:u((()=>[(c(!0),b(k,null,P(a.classifyData,((t,e)=>(c(),r(g,{class:A(a.scrollClassifyIndex===e?"openClassify classifyItem":"classifyItem"),onClick:s=>a.classifyCheck(t,e)},{default:u((()=>[d(g,null,{default:u((()=>[m(p(t.clf_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),256))])),_:1}),d(v,{ref:"materialMod",class:"right scroll-Y materialList","scroll-y":"true","lower-threshold":"50","scroll-into-view":a.classifyDomId,onScrolltolower:a.lower,onScroll:a.scroll},{default:u((()=>[d(y,{materialData:a.materialData,onJiaReaction:a.toCartInsert,onJianReaction:a.getCartCountAndPrice},null,8,["materialData","onJiaReaction","onJianReaction"]),d(g,{class:"loading"},{default:u((()=>[m(p(a.loading?"加载中":"到底喽"),1)])),_:1})])),_:1},8,["scroll-into-view","onScrolltolower","onScroll"])])),_:1}),d(C,{reactionMaterials:a.reactionMaterials,onJiaReaction:a.toCartInsert},null,8,["reactionMaterials","onJiaReaction"]),d(S,{countAndPrice:a.countAndPrice},null,8,["countAndPrice"])])),_:1})}],["__scopeId","data-v-6383341e"]]);export{B as default};
