var e=Object.defineProperty,i=Object.defineProperties,n=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(i,n,t)=>n in i?e(i,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[n]=t,r=(e,i)=>{for(var n in i||(i={}))a.call(i,n)&&s(e,n,i[n]);if(t)for(var n of t(i))o.call(i,n)&&s(e,n,i[n]);return e};import{_ as c,G as l,ay as u,aK as d,J as f,aL as p,a1 as g,T as h,au as y,aM as m,U as b,a as v,c as k,o as w,d as L,w as _,e as O,p as N,f as j,t as x,m as C,F as P,q as I,h as T,k as U,D as B}from"./vendor.1f020a26.js";import{a as M}from"./index.1e1ef7c1.js";var $,S;var A=c({data:()=>({title:"login",providerList:[],phoneNumber:"",univerifyBtnLoading:!1}),computed:r({},l(["hasLogin","isUniverifyLogin","univerifyErrorMsg"])),onLoad(){u({service:"oauth",success:e=>{this.providerList=e.provider.map((e=>{let i="";switch(e){case"weixin":i="微信登录";break;case"qq":i="QQ登录";break;case"sinaweibo":i="新浪微博登录";break;case"xiaomi":i="小米登录";break;case"alipay":i="支付宝登录";break;case"baidu":i="百度登录";break;case"jd":i="京东登录";break;case"toutiao":i="头条登录";break;case"apple":i="苹果登录";break;case"univerify":i="一键登录"}return{name:i,id:e}}))},fail:e=>{console.log("获取登录通道失败",e)}}),this.hasLogin&&this.isUniverifyLogin&&this.getPhoneNumber(d("univerifyInfo")).then((e=>{this.phoneNumber=e}))},methods:($=r(r({},f(["login","setUniverifyLogin"])),p(["getPhoneNumber"])),S={Toast(e,i=1e3){g(Object.assign({},e,{duration:i}))},tologin(e){"univerify"===e.id&&(this.univerifyBtnLoading=!0),h({provider:e.id,success:async i=>{console.log("login success:",i),this.Toast({title:"登录成功"}),this.login(e.id)},fail:e=>{if(console.log("login fail:",e),"30002"==e.code)return uni.closeAuthView(),void this.Toast({title:"其他登录方式"});1e3!=e.code?"30005"!=e.code?"30003"!=e.code&&y({showCancel:!1,title:"登录失败",content:JSON.stringify(e)}):y({showCancel:!1,title:"预登录失败",content:this.univerifyErrorMsg||e.errMsg}):y({title:"登录失败",content:`${e.errMsg}\n，错误码：${e.code}`,confirmText:"开通指南",cancelText:"确定",success:e=>{e.confirm&&setTimeout((()=>{plus.runtime.openWeb("https://ask.dcloud.net.cn/article/37965")}),500)}})},complete:()=>{this.univerifyBtnLoading=!1}})},loginByUniverify(e,i){this.setUniverifyLogin(!0),uni.closeAuthView();const n=r({provider:e},i.authResult);this.getPhoneNumber(n).then((e=>{this.phoneNumber=e,m("univerifyInfo",n)})).catch((e=>{y({showCancel:!1,title:"手机号获取失败",content:`${e.errMsg}\n，错误码：${e.code}`}),console.error(i)}))},async loginByApple(e,i){let n,t;try{t=await uni.getUserInfo({provider:e})}catch(a){n=a}if(n){let e=n.errMsg;~e.indexOf("uni.login")&&(e="请在登录页面完成登录操作"),y({title:"获取用户信息失败",content:"错误原因"+e,showCancel:!1})}console.warn("此处使用uni-id处理苹果登录，详情参考: https://uniapp.dcloud.net.cn/uniCloud/uni-id"),b({url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/user-center",method:"POST",data:{action:"loginByApple",params:t.userInfo},success:e=>{console.log("uniId login success",e),0!==e.data.code?y({showCancel:!1,content:`苹果登录失败: ${JSON.stringify(e.data.msg)}`}):(m("openid",e.data.openid),m("apple_nickname",e.data.userInfo.nickname))},fail:e=>{y({content:`苹果登录失败: ${JSON.stringify(e)}`,showCancel:!1})}})}},i($,n(S)))},[["render",function(e,i,n,t,a,o){const s=v(k("page-head"),M),r=T,c=U,l=B;return w(),L(c,null,{default:_((()=>[O(s,{title:a.title},null,8,["title"]),O(c,{class:"uni-padding-wrap"},{default:_((()=>[O(c,{style:{background:"#FFF",padding:"40rpx"}},{default:_((()=>[!0===e.hasLogin?(w(),N(P,{key:0},[O(c,{class:"uni-h3 uni-center uni-common-mt"},{default:_((()=>[j("已登录 "),e.isUniverifyLogin?(w(),L(r,{key:0,style:{"font-size":"0.8em"}},{default:_((()=>[a.phoneNumber.length?(w(),N("i",{key:1},"（"+x(a.phoneNumber)+"）",1)):(w(),N("i",{key:0,class:"uni-icon_toast uni-loading"}))])),_:1})):C("",!0)])),_:1}),O(c,{class:"uni-hello-text uni-center"},{default:_((()=>[O(r,null,{default:_((()=>[j("每个账号仅需登录 1 次，\\n后续每次进入页面即可自动拉取用户信息。")])),_:1})])),_:1})],64)):C("",!0),!1===e.hasLogin?(w(),N(P,{key:1},[O(c,{class:"uni-h3 uni-center uni-common-mt"},{default:_((()=>[j("未登录")])),_:1}),O(c,{class:"uni-hello-text uni-center"},{default:_((()=>[j(" 请点击按钮登录 ")])),_:1})],64)):C("",!0)])),_:1}),O(c,{class:"uni-btn-v uni- uni-common-mt"},{default:_((()=>[(w(!0),N(P,null,I(a.providerList,((e,i)=>(w(),L(l,{type:"primary",class:"page-body-button",onClick:i=>o.tologin(e),loading:"univerify"===e.id&&a.univerifyBtnLoading,key:i},{default:_((()=>[j(x(e.name),1)])),_:2},1032,["onClick","loading"])))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-00c4b25c"]]);export{A as default};
