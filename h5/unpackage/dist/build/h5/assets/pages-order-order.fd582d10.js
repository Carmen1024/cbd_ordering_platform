var a=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,l=(e,s,t)=>s in e?a(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,c=(a,c)=>{for(var o in c||(c={}))s.call(c,o)&&l(a,o,c[o]);if(e)for(var o of e(c))t.call(c,o)&&l(a,o,c[o]);return a};import{D as o,_ as n,o as i,N as r,e as d,w as _,f as u,L as m,Q as f,O as h,d as p,F as g,W as y,X as v,h as k,k as L,i as I,a0 as b,a1 as C,E as j,$ as A,R as w,T as O,Y as $,Z as x,s as P,U as T}from"./vendor.c7c2a947.js";import{b as H,c as M}from"./order.3e03155d.js";import{a as R}from"./home.13e9b574.js";import{g as S}from"./token.8c82a9be.js";import"./request.fff8ccac.js";var D=n(o({props:{addrList:{type:Array,default:()=>[]}},setup:a=>({}),methods:{change(a){this.$emit("change",a)},close(){this.$emit("close")}}}),[["render",function(a,e,s,t,l,c){const o=k,n=L;return i(),r(f,null,[d(n,{class:"address-container"},{default:_((()=>[d(n,{class:"addressTitle"},{default:_((()=>[d(o,null,{default:_((()=>[u("请选择收货地址")])),_:1}),m("span",{class:"right icon iconfont icon-close",onClick:e[0]||(e[0]=(...e)=>a.close&&a.close(...e))})])),_:1}),d(n,{class:"addressList"},{default:_((()=>[(i(!0),r(f,null,h(a.addrList,((e,s)=>(i(),p(n,{class:"addressItem",onClick:s=>a.change(e)},{default:_((()=>[d(n,{class:"title"},{default:_((()=>[d(n,{class:"left"},{default:_((()=>[d(o,{class:"name"},{default:_((()=>[u(g(e.s_a_name),1)])),_:2},1024),d(o,{class:"phone"},{default:_((()=>[u(g(e.s_a_phone),1)])),_:2},1024),y(d(o,{class:"default"},{default:_((()=>[u("默认")])),_:2},1536),[[v,e.s_a_default]])])),_:2},1024)])),_:2},1024),d(n,{class:"content"},{default:_((()=>[u(g(e.s_a_province)+" "+g(e.s_a_area)+" "+g(e.s_a_city)+" "+g(e.s_a_detail),1)])),_:2},1024)])),_:2},1032,["onClick"])))),256))])),_:1})])),_:1}),d(n,{class:"uni-mask",onClick:a.close},null,8,["onClick"])],64)}],["__scopeId","data-v-1a9d4a67"]]);var E=n(o({props:{commodityList:{type:Array,default:()=>[]}},setup:a=>({}),methods:{}}),[["render",function(a,e,s,t,l,c){const o=I,n=L,y=k;return i(),p(n,{class:"commodityList"},{default:_((()=>[(i(!0),r(f,null,h(a.commodityList,((a,e)=>(i(),p(n,{class:"commodityItem"},{default:_((()=>[d(o,{src:a.m_pic||"/static/logo.jpg"},null,8,["src"]),d(n,{class:"detail"},{default:_((()=>[d(n,{class:"name"},{default:_((()=>[u(g(a.o_m_name),1)])),_:2},1024),d(n,{class:"unit"},{default:_((()=>[u(g(a.m_package),1)])),_:2},1024),d(n,{class:"price"},{default:_((()=>[d(y,{class:"total"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(" "+g(a.m_price||10),1)])),_:2},1024),d(n,{class:"numHandle"},{default:_((()=>[d(y,null,{default:_((()=>[u(g(a.o_m_count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})}],["__scopeId","data-v-09741549"]]);var F=n(o({props:{commodityList:{type:Array,default:()=>[]}},setup:a=>({}),methods:{checkboxChange(a){const e=a.detail.value;this.$emit("change",e)}}}),[["render",function(a,e,s,t,l,c){const o=L,n=b,y=I,v=k,j=C;return i(),r(f,null,[d(o,{class:"title"},{default:_((()=>[u(" 关联物料 ")])),_:1}),d(j,{onChange:a.checkboxChange,class:"commodityList"},{default:_((()=>[(i(!0),r(f,null,h(a.commodityList,((a,e)=>(i(),p(o,{class:"commodityItem"},{default:_((()=>[d(n,{checked:a.checked,value:a.r_m_id,disabled:a.m_stock<a.m_c_count},null,8,["checked","value","disabled"]),d(y,{src:a.m_pic||"/static/logo.jpg"},null,8,["src"]),d(o,{class:"detail"},{default:_((()=>[d(o,{class:"name"},{default:_((()=>[u(g(a.o_m_name),1)])),_:2},1024),d(o,{class:"unit"},{default:_((()=>[u(g(a.m_package),1)])),_:2},1024),d(o,{class:"price"},{default:_((()=>[d(v,{class:"total"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(" "+g(a.m_price||10),1)])),_:2},1024),d(o,{class:"numHandle"},{default:_((()=>[d(v,null,{default:_((()=>[u(g(a.r_m_count||1),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1},8,["onChange"])],64)}],["__scopeId","data-v-0d87e848"]]);const N=o({props:{commodityList:{type:Array,default:()=>[]}},setup:a=>({}),methods:{checkboxChange(a){const e=a.detail.value;this.$emit("change",e)}}});var q=n(o({components:{addressList:D,commodityList:E,relaList:F,cycleList:n(N,[["render",function(a,e,s,t,l,c){const o=L,n=b,y=I,v=k,j=C;return i(),r(f,null,[d(o,{class:"title"},{default:_((()=>[u(" 周期物料 ")])),_:1}),d(j,{onChange:a.checkboxChange,class:"commodityList"},{default:_((()=>[(i(!0),r(f,null,h(a.commodityList,((a,e)=>(i(),p(o,{class:"commodityItem"},{default:_((()=>[d(n,{checked:a.checked,value:a.r_m_id,disabled:a.m_stock<a.m_c_count},null,8,["checked","value","disabled"]),d(y,{src:a.m_pic||"/static/logo.jpg"},null,8,["src"]),d(o,{class:"detail"},{default:_((()=>[d(o,{class:"name"},{default:_((()=>[u(g(a.o_m_name),1)])),_:2},1024),d(o,{class:"unit"},{default:_((()=>[u(g(a.m_package),1)])),_:2},1024),d(o,{class:"price"},{default:_((()=>[d(v,{class:"total"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(" "+g(a.m_price||10),1)])),_:2},1024),d(o,{class:"numHandle"},{default:_((()=>[d(v,null,{default:_((()=>[u(g(a.r_m_count||1),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1},8,["onChange"])],64)}],["__scopeId","data-v-70064458"]])},onLoad(a){this.cartMaterialList=JSON.parse(S("orderMList")),this.getAddressList()},onShow(a){this.showAddress=!1},setup(){const a=j({}),e=j({}),s=j({}),t=j(!1),l=j({}),o=j(!0),n=j(!1),i=j(!1),r=j({user_choice_rela:!1,user_actual_choice_rela:[]}),d=j({user_choice_cycle:!1,user_actual_choice_cycle:[]}),_=()=>{n.value=!1,setTimeout((()=>{$({icon:"loading",title:"正在加载中",duration:1e4})}),100);const t=[];s.value=a.value.map((a=>(t.push(a._id),{m_id:a.m_id,o_m_count:a.m_c_count,m_u_unit:"1"}))),o.value||((()=>{const a=(e.value.rela_materials_msg||[]).filter((a=>a.checked)).map((a=>({r_m_id:a.r_m_id,r_m_count:a.r_m_count,m_u_unit:a.m_u_unit})));r.value={user_choice_rela:!0,user_actual_choice_rela:a}})(),(()=>{const a=(e.value.cycle_materials_msg||[]).filter((a=>a.checked)).map((a=>({r_m_id:a.r_m_id,r_m_count:a.r_m_count,m_u_unit:a.m_u_unit})));d.value={user_choice_cycle:!0,user_actual_choice_cycle:a}})());const i=c(c({s_id:"10",r_g_id:"1",a_id:l.value._id,c_ids:t,materials:s.value},r.value),d.value);return new Promise((function(a,s){H(i).then((s=>{e.value=s.data,n.value=!0,a("resolve")}))}))},u=()=>{const a=e.value.cache_order_key;M({cache_order_key:a}).then((a=>{$({title:"创建订单成功",duration:2e3}),setTimeout((function(){P({url:"/pages/tabBar/order/order"})}),2e3)}))},m=()=>{if(0==f.value.length)return void(i.value=!0);(a=>{l.value=a,_().then((a=>{o.value=!1,A()}))})(f.value.find((a=>a.s_a_default))||f.value[0])},f=j([]);return{cartMaterialList:a,getOrderInf:_,orderInformation:e,cartList:s,lastConfirm:()=>{_().then((a=>{x({content:"是否已经确认",showCancel:!0,success:function(a){a.confirm&&u()}})}))},submit:u,showAddress:t,addr:l,addrList:f,getAddressList:()=>{R({s_id:"10"}).then((a=>{f.value=a.data.filter((a=>2==a.s_a_audit_status)),m()}))},ready:n,noAddr:i}},methods:{changeAddr(a){this.addr=a,this.showAddress=!1,this.getOrderInf().then((a=>{this.confirmFirst=!1,A()}))},closeAddr(){console.log("close"),this.showAddress=!1},changeRela(a){this.orderInformation.rela_materials_msg.map((e=>{a.includes(e.r_m_id)?this.$set(e,"checked",!0):this.$set(e,"checked",!1)})),console.log(this.orderInformation.rela_materials_msg)},changeCycle(){this.orderInformation.cycle_materials_msg.map((a=>{values.includes(a.r_m_id)?this.$set(a,"checked",!0):this.$set(a,"checked",!1)})),console.log(this.orderInformation.cycle_materials_msg)}}}),[["render",function(a,e,s,t,l,c){const o=L,n=k,r=w("commodity-list"),f=w("rela-list"),h=w("cycle-list"),I=T;return i(),p(o,{class:"order-container"},{default:_((()=>[a.addrList.length>0?(i(),p(o,{key:0,class:"order-address"},{default:_((()=>[m("span",{class:"icon iconfont icon-dituguanli"}),a.addr.s_a_name?(i(),p(o,{key:0,class:"address-main"},{default:_((()=>[d(o,{class:"detail"},{default:_((()=>[u(g(a.addr.s_a_province)+" "+g(a.addr.s_a_area)+" "+g(a.addr.s_a_city)+" "+g(a.addr.s_a_detail),1)])),_:1}),d(o,{class:"name"},{default:_((()=>[u(g(a.addr.s_a_name)+" "+g(a.addr.s_a_phone),1)])),_:1})])),_:1})):(i(),p(o,{key:1,class:"address-main"},{default:_((()=>[d(o,{class:"detail"},{default:_((()=>[u("您还没有有效的收货地址")])),_:1}),d(o,{class:"name"},{default:_((()=>[u("暂时无法下单")])),_:1})])),_:1}))])),_:1})):O("",!0),a.noAddr?(i(),p(o,{key:1,class:"noData"},{default:_((()=>[d(o,null,{default:_((()=>[m("span",{class:"icon iconfont icon-dituguanli"})])),_:1}),d(o,null,{default:_((()=>[d(n,null,{default:_((()=>[u("您还没有收货地址")])),_:1})])),_:1}),d(o,null,{default:_((()=>[d(n,null,{default:_((()=>[u("暂时无法下单")])),_:1})])),_:1})])),_:1})):O("",!0),y(d(o,null,{default:_((()=>{var e,s,t,l;return[d(r,{commodityList:a.orderInformation.actual_buy_materials_msg},null,8,["commodityList"]),a.orderInformation.rela_materials_msg&&a.orderInformation.rela_materials_msg.length>0?(i(),p(f,{key:0,commodityList:null==(e=a.orderInformation)?void 0:e.rela_materials_msg,onChange:a.changeRela},null,8,["commodityList","onChange"])):O("",!0),(null==(s=a.orderInformation)?void 0:s.cycle_materials_msg)&&(null==(t=a.orderInformation)?void 0:t.cycle_materials_msg.length)>0?(i(),p(h,{key:1,commodityList:null==(l=a.orderInformation)?void 0:l.cycle_materials_msg,onChange:a.changeCycle},null,8,["commodityList","onChange"])):O("",!0),d(o,{class:"other"},{default:_((()=>[d(o,{class:"other-item"},{default:_((()=>[d(n,{class:"left"},{default:_((()=>[u("账户余额")])),_:1}),d(n,{class:"right"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(g(a.orderInformation.remain||0)+"元",1)])),_:1})])),_:1}),d(o,{class:"other-item"},{default:_((()=>[d(n,{class:"left"},{default:_((()=>[u("商品总额")])),_:1}),d(n,{class:"right"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(g(a.orderInformation.total_price||0)+"元",1)])),_:1})])),_:1}),d(o,{class:"other-item"},{default:_((()=>[d(n,{class:"left"},{default:_((()=>[u("合计运费")])),_:1}),d(n,{class:"right"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(g(a.orderInformation.freight_price||0)+"元",1)])),_:1})])),_:1}),d(o,{class:"other-item"},{default:_((()=>[d(n,{class:"left"},{default:_((()=>[u("价格等级优惠")])),_:1}),d(n,{class:"right"},{default:_((()=>[m("span",{class:"icon iconfont icon-jian"}),m("span",{class:"icon iconfont icon-jine"}),u(g(a.orderInformation.grade_discount_price||0)+"元 ",1)])),_:1})])),_:1}),d(o,{class:"other-item"},{default:_((()=>[d(n,{class:"left"},{default:_((()=>[u("使用返利金")])),_:1}),d(n,{class:"right"},{default:_((()=>[m("span",{class:"icon iconfont icon-jian"}),m("span",{class:"icon iconfont icon-jine"}),u(g(a.orderInformation.refund_price||0)+"元 ",1)])),_:1})])),_:1})])),_:1}),d(o,{class:"account"},{default:_((()=>[d(o,{class:"right"},{default:_((()=>[d(o,{class:"totalPrice"},{default:_((()=>[d(n,null,{default:_((()=>[u("合计：")])),_:1}),d(n,{class:"priceTotal"},{default:_((()=>[m("span",{class:"icon iconfont icon-jine"}),u(g(a.orderInformation.actual_pay_price),1)])),_:1})])),_:1}),d(I,{class:"uni-button",type:"primary",size:"mini",onClick:a.lastConfirm},{default:_((()=>[u("确认订单")])),_:1},8,["onClick"])])),_:1})])),_:1})]})),_:1},512),[[v,a.ready]])])),_:1})}],["__scopeId","data-v-45d5df3e"]]);export{q as default};
