import{g as e,a5 as t,_ as a,o as s,d as l,w as i,R as n,P as o,a8 as d,e as r,X as c,f as h,N as u,i as p,k as g,h as m,a as f,c as y,T as _,V as v,U as D,Z as k,W as x,a7 as A,$ as w,a0 as b,ab as C,K as I,M as V,Y as S,ae as N,D as M,ag as E,ah as T,a4 as B,ai as F}from"./vendor.814d7eca.js";import{c as L,d as R,e as j,g as J,l as P,f as G,h as z,i as O}from"./index.e1c48d14.js";import{_ as Z}from"./uni-icons.e57e5a6e.js";import{w as U}from"./uni-cloud.es.079b2f6d.js";import{B as W}from"./backLayer.4c1c377c.js";const Y=[{value:1,label:"s_a_name",tip:"请输入收件人"},{value:2,label:"s_a_phone",tip:"请输入手机号"},{value:3,label:"s_a_province",tip:"请选择省"},{value:4,label:"s_a_city",tip:"请选择市"},{value:5,label:"s_a_area",tip:"请选择区"},{value:6,label:"s_a_detail",tip:"请输入详细地址"}];var H={en:{"uni-load-more.contentdown":"Pull up to show more","uni-load-more.contentrefresh":"loading...","uni-load-more.contentnomore":"No more data"},"zh-Hans":{"uni-load-more.contentdown":"上拉显示更多","uni-load-more.contentrefresh":"正在加载...","uni-load-more.contentnomore":"没有更多数据了"},"zh-Hant":{"uni-load-more.contentdown":"上拉顯示更多","uni-load-more.contentrefresh":"正在加載...","uni-load-more.contentnomore":"沒有更多數據了"}};let Q;setTimeout((()=>{Q=e().platform}),16);const{t:X}=t(H);var K=a({name:"UniLoadMore",emits:["clickLoadMore"],props:{status:{type:String,default:"more"},showIcon:{type:Boolean,default:!0},iconType:{type:String,default:"auto"},iconSize:{type:Number,default:24},color:{type:String,default:"#777777"},contentText:{type:Object,default:()=>({contentdown:"",contentrefresh:"",contentnomore:""})},showText:{type:Boolean,default:!0}},data:()=>({webviewHide:!1,platform:Q,imgBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzlBMzU3OTlEOUM0MTFFOUI0NTZDNERBQURBQzI4RkUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzlBMzU3OUFEOUM0MTFFOUI0NTZDNERBQURBQzI4RkUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDOUEzNTc5N0Q5QzQxMUU5QjQ1NkM0REFBREFDMjhGRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDOUEzNTc5OEQ5QzQxMUU5QjQ1NkM0REFBREFDMjhGRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pt+ALSwAAA6CSURBVHja1FsLkFZV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"}),computed:{iconSnowWidth(){return 2*(Math.floor(this.iconSize/24)||1)},contentdownText(){return this.contentText.contentdown||X("uni-load-more.contentdown")},contentrefreshText(){return this.contentText.contentrefresh||X("uni-load-more.contentrefresh")},contentnomoreText(){return this.contentText.contentnomore||X("uni-load-more.contentnomore")}},mounted(){},methods:{onClick(){this.$emit("clickLoadMore",{detail:{status:this.status}})}}},[["render",function(e,t,a,f,y,_){const v=p,D=g,k=m;return s(),l(D,{class:"uni-load-more",onClick:_.onClick},{default:i((()=>[!y.webviewHide&&("circle"===a.iconType||"auto"===a.iconType&&"android"===y.platform)&&"loading"===a.status&&a.showIcon?(s(),n("svg",{key:0,width:"24",height:"24",viewBox:"25 25 50 50",style:d({width:a.iconSize+"px",height:a.iconSize+"px"}),class:"uni-load-more__img uni-load-more__img--android-H5"},[o("circle",{cx:"50",cy:"50",r:"20",fill:"none",style:d({color:a.color}),"stroke-width":3},null,4)],4)):!y.webviewHide&&"loading"===a.status&&a.showIcon?(s(),l(D,{key:1,style:d({width:a.iconSize+"px",height:a.iconSize+"px"}),class:"uni-load-more__img uni-load-more__img--ios-H5"},{default:i((()=>[r(v,{src:y.imgBase64,mode:"widthFix"},null,8,["src"])])),_:1},8,["style"])):c("",!0),a.showText?(s(),l(k,{key:2,class:"uni-load-more__text",style:d({color:a.color})},{default:i((()=>[h(u("more"===a.status?_.contentdownText:"loading"===a.status?_.contentrefreshText:_.contentnomoreText),1)])),_:1},8,["style"])):c("",!0)])),_:1},8,["onClick"])}],["__scopeId","data-v-7bb3b8ac"]]),q={props:{localdata:{type:[Array,Object],default:()=>[]},spaceInfo:{type:Object,default:()=>({})},collection:{type:String,default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},getone:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},manual:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>[]},modelValue:{type:[Array,String,Number],default:()=>[]},preload:{type:Boolean,default:!1},stepSearh:{type:Boolean,default:!0},selfField:{type:String,default:""},parentField:{type:String,default:""},multiple:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},data(){return{loading:!1,errorMessage:"",loadMore:{contentdown:"",contentrefresh:"",contentnomore:""},dataList:[],selected:[],selectedIndex:0,page:{current:this.pageCurrent,size:this.pageSize,count:0}}},computed:{isLocaldata(){return!this.collection.length},postField(){let e=[this.field];return this.parentField&&e.push(`${this.parentField} as parent_value`),e.join(",")},dataValue(){return(Array.isArray(this.modelValue)?this.modelValue.length>0:null!==this.modelValue||void 0!==this.modelValue)?this.modelValue:this.value},hasValue(){return"number"==typeof this.dataValue||null!=this.dataValue&&this.dataValue.length>0}},created(){this.$watch((()=>{var e=[];return["pageCurrent","pageSize","spaceInfo","value","modelValue","localdata","collection","action","field","orderby","where","getont","getcount","gettree"].forEach((t=>{e.push(this[t])})),e}),((e,t)=>{for(let a=2;a<e.length&&e[a]==t[a];a++);e[0]!=t[0]&&(this.page.current=this.pageCurrent),this.page.size=this.pageSize,this.onPropsChange()})),this._treeData=[]},methods:{onPropsChange(){this._treeData=[]},getCommand(e={}){let t=U.database(this.spaceInfo);const a=e.action||this.action;a&&(t=t.action(a));const s=e.collection||this.collection;t=t.collection(s);const l=e.where||this.where;l&&Object.keys(l).length&&(t=t.where(l));const i=e.field||this.field;i&&(t=t.field(i));const n=e.orderby||this.orderby;n&&(t=t.orderBy(n));const o=void 0!==e.pageCurrent?e.pageCurrent:this.page.current,d=void 0!==e.pageSize?e.pageSize:this.page.size,r={getCount:void 0!==e.getcount?e.getcount:this.getcount,getTree:void 0!==e.gettree?e.gettree:this.gettree};return e.getTreePath&&(r.getTreePath=e.getTreePath),t=t.skip(d*(o-1)).limit(d).get(r),t},getNodeData(e){this.loading||(this.loading=!0,this.getCommand({field:this.postField,where:this._pathWhere()}).then((t=>{this.loading=!1,this.selected=t.result.data,e&&e()})).catch((e=>{this.loading=!1,this.errorMessage=e})))},getTreePath(e){this.loading||(this.loading=!0,this.getCommand({field:this.postField,getTreePath:{startWith:`${this.selfField}=='${this.dataValue}'`}}).then((t=>{this.loading=!1;let a=[];this._extractTreePath(t.result.data,a),this.selected=a,e&&e()})).catch((e=>{this.loading=!1,this.errorMessage=e})))},loadData(){this.isLocaldata?this._processLocalData():null==this.dataValue?this.stepSearh?this._loadNodeData((e=>{this._treeData=e,this._updateBindData()})):this._loadAllData((e=>{this._treeData=[],this._extractTree(e,this._treeData,null),this._updateBindData()})):this._loadNodeData((e=>{this._treeData=e,this._updateBindData(),this._updateSelected()}))},_loadAllData(e){this.loading||(this.loading=!0,this.getCommand({field:this.postField,gettree:!0,startwith:`${this.selfField}=='${this.dataValue}'`}).then((t=>{this.loading=!1,e(t.result.data),this.onDataChange()})).catch((e=>{this.loading=!1,this.errorMessage=e})))},_loadNodeData(e,t){this.loading||(this.loading=!0,this.getCommand({field:this.postField,where:t||this._postWhere(),pageSize:500}).then((t=>{this.loading=!1,e(t.result.data),this.onDataChange()})).catch((e=>{this.loading=!1,this.errorMessage=e})))},_pathWhere(){let e=[],t=this._getParentNameByField();return t&&e.push(`${t} == '${this.dataValue}'`),this.where?`(${this.where}) && (${e.join(" || ")})`:e.join(" || ")},_postWhere(){let e=[],t=this.selected,a=this.parentField;if(a&&e.push(`${a} == null || ${a} == ""`),t.length)for(var s=0;s<t.length-1;s++)e.push(`${a} == '${t[s].value}'`);let l=[];return this.where&&l.push(`(${this.where})`),e.length&&l.push(`(${e.join(" || ")})`),l.join(" && ")},_nodeWhere(){let e=[],t=this.selected;return t.length&&e.push(`${this.parentField} == '${t[t.length-1].value}'`),this.where?`(${this.where}) && (${e.join(" || ")})`:e.join(" || ")},_getParentNameByField(){const e=this.field.split(",");let t=null;for(let a=0;a<e.length;a++){const s=e[a].split("as");if(!(s.length<2)&&"value"===s[1].trim()){t=s[0].trim();break}}return t},_isTreeView(){return this.parentField&&this.selfField},_updateSelected(){var e=this.dataList,t=this.selected;let a=this.map.text,s=this.map.value;for(var l=0;l<t.length;l++)for(var i=t[l].value,n=e[l],o=0;o<n.length;o++){var d=n[o];if(d[s]===i){t[l].text=d[a];break}}},_updateBindData(e){const{dataList:t,hasNodes:a}=this._filterData(this._treeData,this.selected);let s=!1===this._stepSearh&&!a;return e&&(e.isleaf=s),this.dataList=t,this.selectedIndex=t.length-1,!s&&this.selected.length<t.length&&this.selected.push({value:null,text:"请选择"}),{isleaf:s,hasNodes:a}},_filterData(e,t){let a=[],s=!0;a.push(e.filter((e=>null===e.parent_value||void 0===e.parent_value||""===e.parent_value)));for(let n=0;n<t.length;n++){var l=t[n].value,i=e.filter((e=>e.parent_value===l));i.length?a.push(i):s=!1}return{dataList:a,hasNodes:s}},_extractTree(e,t,a){let s=this.map.value;for(let l=0;l<e.length;l++){let i=e[l],n={};for(let e in i)"children"!==e&&(n[e]=i[e]);null!=a&&""!==a&&(n.parent_value=a),t.push(n);let o=i.children;o&&this._extractTree(o,t,i[s])}},_extractTreePath(e,t){for(let a=0;a<e.length;a++){let s=e[a],l={};for(let e in s)"children"!==e&&(l[e]=s[e]);t.push(l);let i=s.children;i&&this._extractTreePath(i,t)}},_findNodePath(e,t,a=[]){let s=this.map.text,l=this.map.value;for(let i=0;i<t.length;i++){let n=t[i],o=n.children,d=n[s],r=n[l];if(a.push({value:r,text:d}),r===e)return a;if(o){const t=this._findNodePath(e,o,a);if(t.length)return t}a.pop()}return[]},_processLocalData(){this._treeData=[],this._extractTree(this.localdata,this._treeData);var e=this.dataValue;void 0!==e&&(Array.isArray(e)&&"object"==typeof(e=e[e.length-1])&&e[this.map.value]&&(e=e[this.map.value]),this.selected=this._findNodePath(e,this.localdata))}}};var $=a({name:"UniDataPicker",emits:["popupopened","popupclosed","nodeclick","input","change","update:modelValue"],mixins:[q],components:{DataPickerView:a({name:"UniDataPickerView",emits:["nodeclick","change","datachange","update:modelValue"],mixins:[q],props:{managedMode:{type:Boolean,default:!1},ellipsis:{type:Boolean,default:!0}},data:()=>({}),created(){this.managedMode||this.$nextTick((()=>{this.load()}))},methods:{onPropsChange(){this._treeData=[],this.selectedIndex=0,this.load()},load(){this.isLocaldata?this.loadData():this.dataValue.length&&this.getTreePath((e=>{this.loadData()}))},handleSelect(e){this.selectedIndex=e},handleNodeClick(e,t,a){if(e.disable)return;const s=this.dataList[t][a],l=s[this.map.text],i=s[this.map.value];if(t<this.selected.length-1?(this.selected.splice(t,this.selected.length-t),this.selected.push({text:l,value:i})):t===this.selected.length-1&&this.selected.splice(t,1,{text:l,value:i}),s.isleaf)return void this.onSelectedChange(s,s.isleaf);const{isleaf:n,hasNodes:o}=this._updateBindData();(this._isTreeView()||o)&&(!this.isLocaldata||o&&!n)?n||o?this.onSelectedChange(s,!1):this._loadNodeData((e=>{e.length?(this._treeData.push(...e),this._updateBindData(s)):s.isleaf=!0,this.onSelectedChange(s,s.isleaf)}),this._nodeWhere()):this.onSelectedChange(s,!0)},updateData(e){this._treeData=e.treeData,this.selected=e.selected,this._treeData.length?this._updateBindData():this.loadData()},onDataChange(){this.$emit("datachange")},onSelectedChange(e,t){t&&this._dispatchEvent(),e&&this.$emit("nodeclick",e)},_dispatchEvent(){this.$emit("change",this.selected.slice(0))}}},[["render",function(e,t,a,o,d,p){const x=m,A=g,w=k,b=f(y("uni-load-more"),K);return s(),l(A,{class:"uni-data-pickerview"},{default:i((()=>[r(w,{class:"selected-area","scroll-x":"true","scroll-y":"false","show-scrollbar":!1},{default:i((()=>[r(A,{class:"selected-list"},{default:i((()=>[(s(!0),n(v,null,_(e.selected,((t,o)=>(s(),n(v,null,[t.text?(s(),l(A,{class:D(["selected-item",{"selected-item-active":o==e.selectedIndex,"selected-item-text-overflow":a.ellipsis}]),key:o,onClick:e=>p.handleSelect(o)},{default:i((()=>[r(x,{class:""},{default:i((()=>[h(u(t.text),1)])),_:2},1024)])),_:2},1032,["class","onClick"])):c("",!0)],64)))),256))])),_:1})])),_:1}),r(A,{class:"tab-c"},{default:i((()=>[(s(!0),n(v,null,_(e.dataList,((t,a)=>(s(),n(v,null,[a==e.selectedIndex?(s(),l(w,{class:"list",key:a,"scroll-y":!0},{default:i((()=>[(s(!0),n(v,null,_(t,((t,n)=>(s(),l(A,{class:D(["item",{"is-disabled":!!t.disable}]),key:n,onClick:e=>p.handleNodeClick(t,a,n)},{default:i((()=>[r(x,{class:"item-text item-text-overflow"},{default:i((()=>[h(u(t[e.map.text]),1)])),_:2},1024),e.selected.length>a&&t[e.map.value]==e.selected[a].value?(s(),l(A,{key:0,class:"check"})):c("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)):c("",!0)],64)))),256)),e.loading?(s(),l(A,{key:0,class:"loading-cover"},{default:i((()=>[r(b,{class:"load-more",contentText:e.loadMore,status:"loading"},null,8,["contentText"])])),_:1})):c("",!0),e.errorMessage?(s(),l(A,{key:1,class:"error-message"},{default:i((()=>[r(x,{class:"error-text"},{default:i((()=>[h(u(e.errorMessage),1)])),_:1})])),_:1})):c("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-8d86a5bc"]])},props:{options:{type:[Object,Array],default:()=>({})},popupTitle:{type:String,default:"请选择"},placeholder:{type:String,default:"请选择"},heightMobile:{type:String,default:""},readonly:{type:Boolean,default:!1},clearIcon:{type:Boolean,default:!0},border:{type:Boolean,default:!0},split:{type:String,default:"/"},ellipsis:{type:Boolean,default:!0}},data:()=>({isOpened:!1,inputSelected:[]}),created(){this.form=this.getForm("uniForms"),this.formItem=this.getForm("uniFormsItem"),this.formItem&&this.formItem.name&&(this.rename=this.formItem.name,this.form.inputChildrens.push(this)),this.$nextTick((()=>{this.load()}))},methods:{clear(){this.inputSelected.splice(0),this._dispatchEvent([])},onPropsChange(){this._treeData=[],this.selectedIndex=0,this.load()},load(){this.readonly?this._processReadonly(this.localdata,this.dataValue):this.isLocaldata?(this.loadData(),this.inputSelected=this.selected.slice(0)):this.parentField||this.selfField||!this.hasValue?this.hasValue&&this.getTreePath((()=>{this.inputSelected=this.selected.slice(0)})):this.getNodeData((()=>{this.inputSelected=this.selected.slice(0)}))},getForm(e="uniForms"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},show(){this.isOpened=!0,this.$nextTick((()=>{this.$refs.pickerView.updateData({treeData:this._treeData,selected:this.selected,selectedIndex:this.selectedIndex})})),this.$emit("popupopened")},hide(){this.isOpened=!1,this.$emit("popupclosed")},handleInput(){this.readonly||this.show()},handleClose(e){this.hide()},onnodeclick(e){this.$emit("nodeclick",e)},ondatachange(e){this._treeData=this.$refs.pickerView._treeData},onchange(e){this.hide(),this.inputSelected=e,this._dispatchEvent(e)},_processReadonly(e,t){if(e.findIndex((e=>e.children))>-1){let e;return Array.isArray(t)?(e=t[t.length-1],"object"==typeof e&&e.value&&(e=e.value)):e=t,void(this.inputSelected=this._findNodePath(e,this.localdata))}if(!this.hasValue)return void(this.inputSelected=[]);let a=[];for(let i=0;i<t.length;i++){var s=t[i],l=e.find((e=>e.value==s));l&&a.push(l)}a.length&&(this.inputSelected=a)},_filterForArray(e,t){var a=[];for(let i=0;i<t.length;i++){var s=t[i],l=e.find((e=>e.value==s));l&&a.push(l)}return a},_dispatchEvent(e){let t={};if(e.length){for(var a=new Array(e.length),s=0;s<e.length;s++)a[s]=e[s].value;t=e[e.length-1]}else t.value="";this.formItem&&this.formItem.setValue(t.value),this.$emit("input",t.value),this.$emit("update:modelValue",t.value),this.$emit("change",{detail:{value:e}})}}},[["render",function(e,t,a,o,d,p){const I=m,V=f(y("uni-load-more"),K),S=g,N=k,M=f(y("uni-icons"),Z),E=x("data-picker-view");return s(),l(S,{class:"uni-data-tree"},{default:i((()=>[r(S,{class:"uni-data-tree-input",onClick:p.handleInput},{default:i((()=>[A(e.$slots,"default",{options:a.options,data:d.inputSelected,error:e.errorMessage},(()=>[r(S,{class:D(["input-value",{"input-value-border":a.border}])},{default:i((()=>[e.errorMessage?(s(),l(I,{key:0,class:"selected-area error-text"},{default:i((()=>[h(u(e.errorMessage),1)])),_:1})):e.loading&&!d.isOpened?(s(),l(S,{key:1,class:"selected-area"},{default:i((()=>[r(V,{class:"load-more",contentText:e.loadMore,status:"loading"},null,8,["contentText"])])),_:1})):d.inputSelected.length?(s(),l(N,{key:2,class:"selected-area","scroll-x":"true"},{default:i((()=>[r(S,{class:"selected-list"},{default:i((()=>[(s(!0),n(v,null,_(d.inputSelected,((e,t)=>(s(),l(S,{class:"selected-item",key:t},{default:i((()=>[r(I,null,{default:i((()=>[h(u(e.text),1)])),_:2},1024),t<d.inputSelected.length-1?(s(),l(I,{key:0,class:"input-split-line"},{default:i((()=>[h(u(a.split),1)])),_:1})):c("",!0)])),_:2},1024)))),128))])),_:1})])),_:1})):(s(),l(I,{key:3,class:"selected-area placeholder"},{default:i((()=>[h(u(a.placeholder),1)])),_:1})),w(r(S,{class:"icon-clear",onClick:C(p.clear,["stop"])},{default:i((()=>[r(M,{type:"clear",color:"#e1e1e1",size:"14"})])),_:1},8,["onClick"]),[[b,a.clearIcon&&!a.readonly&&d.inputSelected.length]]),a.clearIcon&&d.inputSelected.length||a.readonly?c("",!0):(s(),l(S,{key:4,class:"arrow-area"},{default:i((()=>[r(S,{class:"input-arrow"})])),_:1}))])),_:1},8,["class"])]),!0)])),_:3},8,["onClick"]),d.isOpened?(s(),l(S,{key:0,class:"uni-data-tree-cover",onClick:p.handleClose},null,8,["onClick"])):c("",!0),d.isOpened?(s(),l(S,{key:1,class:"uni-data-tree-dialog"},{default:i((()=>[r(S,{class:"uni-popper__arrow"}),r(S,{class:"dialog-caption"},{default:i((()=>[r(S,{class:"title-area"},{default:i((()=>[r(I,{class:"dialog-title"},{default:i((()=>[h(u(a.popupTitle),1)])),_:1})])),_:1}),r(S,{class:"dialog-close",onClick:p.handleClose},{default:i((()=>[r(S,{class:"dialog-close-plus","data-id":"close"}),r(S,{class:"dialog-close-plus dialog-close-rotate","data-id":"close"})])),_:1},8,["onClick"])])),_:1}),r(E,{class:"picker-view",ref:"pickerView",modelValue:e.dataValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dataValue=t),localdata:e.localdata,preload:e.preload,collection:e.collection,field:e.field,orderby:e.orderby,where:e.where,"step-searh":e.stepSearh,"self-field":e.selfField,"parent-field":e.parentField,"managed-mode":!0,map:e.map,ellipsis:a.ellipsis,onChange:p.onchange,onDatachange:p.ondatachange,onNodeclick:p.onnodeclick},null,8,["modelValue","localdata","preload","collection","field","orderby","where","step-searh","self-field","parent-field","map","ellipsis","onChange","onDatachange","onNodeclick"])])),_:1})):c("",!0)])),_:3})}],["__scopeId","data-v-b1ac1ff0"]]);const ee=I({props:{address:{type:Object,default:()=>({s_a_province:"",s_a_city:"",s_a_area:""})}},setup(e){V(!1);const t=V({}),a=V({}),s=V({}),l=V([]),i=V([]),n=V([]);V([]);L().then((e=>{l.value=e.data.map((e=>({text:e.province,value:e.provinceid})))}));return{provinceList:l,cityList:i,areaList:n,provinceData:t,cityData:a,areaData:s,getCityList:e=>{R(e).then((e=>{i.value=e.data.map((e=>({text:e.city,value:e.cityid})))}))},getAreaList:e=>{j(e).then((e=>{n.value=e.data.map((e=>({text:e.area,value:e.areaid})))}))}}},methods:{provinceonnodeclick(e){if(this.provinceData.text==e.text)return;this.provinceData=e,this.cityList=[],this.cityData={},this.areaList=[],this.areaData={};const t={provinceid:e.value};this.getCityList(t)},cityonnodeclick(e){if(this.cityData.text==e.text)return;this.cityData=e,this.areaList=[],this.areaData={};const t={cityid:e.value};this.getAreaList(t)},areaonnodeclick(e){this.areaData=e},submit(){const e={provinceData:this.provinceData,cityData:this.cityData,areaData:this.areaData};this.$emit("change",e)},close(){this.$emit("close")}}});var te=a(I({onLoad:function(e){this.setAddr(JSON.parse(J("addressDetail")))},components:{areaPicker:a(ee,[["render",function(e,t,a,n,d,c){const u=m,p=g,_=f(y("uni-data-picker"),$),v=S;return s(),l(p,{class:"areaPicker"},{default:i((()=>[r(p,{class:"area"},{default:i((()=>[r(p,{class:"areaTitle"},{default:i((()=>[r(u,null,{default:i((()=>[h("请选择所在地区")])),_:1}),o("span",{class:"right icon iconfont icon-close",onClick:t[0]||(t[0]=(...t)=>e.close&&e.close(...t))})])),_:1}),r(p,{class:"areaOperate"},{default:i((()=>[r(_,{localdata:e.provinceList,"clear-icon":"false",placeholder:"请选择省","popup-title":"请选择省",onChange:e.provinceonchange,onNodeclick:e.provinceonnodeclick},null,8,["localdata","onChange","onNodeclick"]),r(_,{localdata:e.cityList,placeholder:"请选择市","popup-title":"请选择市",onChange:e.cityonchange,onNodeclick:e.cityonnodeclick},null,8,["localdata","onChange","onNodeclick"]),r(_,{localdata:e.areaList,placeholder:"请选择区/县","popup-title":"请选择区/县",onChange:e.areaonchange,onNodeclick:e.areaonnodeclick},null,8,["localdata","onChange","onNodeclick"])])),_:1})])),_:1}),r(v,{class:"submit",size:"mini",onClick:e.submit},{default:i((()=>[h("确认")])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-02fde6a5"]]),BackLayer:W},setup(){const e=N({title:"地址详情",backUrl:"/pages/address/address"}),{s_id:t,r_g_id:a}=P(),s=V(!1),l=V({}),i=N({title:"",item:{}});return{address:l,setAddr:e=>{T({title:e.title}),i.title=e.title;const a=e.item?e.item:null;a?(i.item=a,l.value=a):(delete i.item,l.value={s_id:t,s_a_name:"",s_a_phone:"",s_a_province:"",s_a_city:"",s_a_area:"",s_a_detail:"",s_a_postcode:""})},layer:i,areaOperate:s,back:e}},methods:{switch1Change:function(e){this.address.s_a_default=!this.address.s_a_default},verify(){const e=this.address;return new Promise((function(t,a){for(let s of Y)if(""==e[s.label]){M({title:s.tip,duration:2e3,icon:"error"}),a("error");break}t("success")}))},submit(){this.verify().then((()=>{this.layer.item?this.update():this.insert()}))},insert(){const e=this.address;e.s_a_default=this.address.s_a_default?"1":"0",e.s_id=this.s_id,G(e).then((e=>{M({title:"新增成功",duration:2e3,icon:"none"}),E()}))},update(){const e=this.address;e.s_a_default=this.address.s_a_default?"1":"0",e.s_id=this.s_id,z(e).then((e=>{M({title:"保存成功",duration:2e3,icon:"none"}),E()}))},deleteD(){const e={_id:this.address._id,c_del:1};O(e).then((e=>{M({title:"删除成功",duration:2e3,icon:"none"}),E()}))},changeArea(e){this.address.s_a_province=e.provinceData.text||"",this.address.s_a_city=e.cityData.text||"",this.address.s_a_area=e.areaData.text||"",this.closeArea()},closeArea(){this.areaOperate=!1}}}),[["render",function(e,t,a,l,o,d){const c=x("back-layer"),p=m,f=B,y=g,_=x("area-picker"),D=F,k=S;return s(),n(v,null,[r(c,{back:e.back},null,8,["back"]),w(r(y,{class:"address-container"},{default:i((()=>[r(y,{class:"address-container-item"},{default:i((()=>[r(p,null,{default:i((()=>[h("收件人")])),_:1}),r(f,{class:"uni-input",maxlength:"16",modelValue:e.address.s_a_name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.address.s_a_name=t),placeholder:"收件人姓名"},null,8,["modelValue"])])),_:1}),r(y,{class:"address-container-item"},{default:i((()=>[r(p,null,{default:i((()=>[h("手机号")])),_:1}),r(f,{class:"uni-input",maxlength:"11",type:"number",modelValue:e.address.s_a_phone,"onUpdate:modelValue":t[1]||(t[1]=t=>e.address.s_a_phone=t),placeholder:"手机号"},null,8,["modelValue"])])),_:1}),r(y,{class:"address-container-item"},{default:i((()=>[r(p,null,{default:i((()=>[h("所在地区")])),_:1}),r(y,{onClick:t[2]||(t[2]=t=>e.areaOperate=!0)},{default:i((()=>[h(u(e.address.s_a_province)+" "+u(e.address.s_a_city)+" "+u(e.address.s_a_area),1)])),_:1})])),_:1}),w(r(_,{address:e.address,onChange:e.changeArea,onClose:e.closeArea},null,8,["address","onChange","onClose"]),[[b,e.areaOperate]]),r(y,{class:"address-container-item",style:{height:"150rpx"}},{default:i((()=>[r(p,null,{default:i((()=>[h("详细地址")])),_:1}),r(D,{class:"uni-textarea",maxlength:"64",placeholder:"详细地址",modelValue:e.address.s_a_detail,"onUpdate:modelValue":t[3]||(t[3]=t=>e.address.s_a_detail=t)},null,8,["modelValue"])])),_:1}),r(y,{class:"address-container-item"},{default:i((()=>[r(p,null,{default:i((()=>[h("邮编")])),_:1}),r(f,{class:"uni-input",maxlength:"12",type:"number",modelValue:e.address.s_a_postcode,"onUpdate:modelValue":t[4]||(t[4]=t=>e.address.s_a_postcode=t),placeholder:"邮编"},null,8,["modelValue"])])),_:1}),r(k,{class:"submit",type:"primary",onClick:e.submit},{default:i((()=>[h("确认")])),_:1},8,["onClick"])])),_:1},512),[[b,e.address]])],64)}],["__scopeId","data-v-25a466a6"]]);export{te as default};
