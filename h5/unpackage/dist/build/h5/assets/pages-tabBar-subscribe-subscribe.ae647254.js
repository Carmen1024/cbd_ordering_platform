var a=Object.defineProperty,t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,e,s)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;import{K as o,s as i,_ as n,o as c,d as r,w as u,e as d,P as f,f as m,N as p,X as _,h as g,k as h,Y as y,M as v,C,W as I,R as b,T as P,V as w,i as A,Z as k,U as D}from"./vendor.814d7eca.js";import{r as S,m as j}from"./materialItem.309d0205.js";import{m as T,c as M,a as L,b as x,d as O}from"./subscribe.e187e6ec.js";import{l as R,_ as z}from"./index.e1c48d14.js";const B=o({props:{countAndPrice:{type:Object,default:()=>({total:0,price:0})}},setup:a=>({}),methods:{toCart(){i({url:"/pages/tabBar/shoppingCart/shoppingCart"})}}});var J=n(o({components:{cart:n(B,[["render",function(a,t,e,s,l,o){const i=g,n=h,v=y;return c(),r(n,{class:"cart-container"},{default:u((()=>[d(n,{class:"account"},{default:u((()=>[d(n,{class:"left",onClick:a.toCart},{default:u((()=>[f("span",{class:"icon iconfont icon-goumai"}),a.countAndPrice.total&&a.countAndPrice.total>0?(c(),r(i,{key:0},{default:u((()=>[m(p(a.countAndPrice.total>=1e3?"999+":a.countAndPrice.total),1)])),_:1})):_("",!0)])),_:1},8,["onClick"]),d(n,{class:"right"},{default:u((()=>[a.countAndPrice.price&&a.countAndPrice.price>0?(c(),r(n,{key:0},{default:u((()=>[d(i,null,{default:u((()=>[m("总计:")])),_:1}),d(i,{class:"priceTotal"},{default:u((()=>[f("span",{class:"icon iconfont icon-jine"}),m(p((a.countAndPrice.price/100).toFixed(2)),1)])),_:1})])),_:1})):_("",!0),d(v,{type:"primary",size:"mini",onClick:a.toCart},{default:u((()=>[m("购物车")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-0b8eaf3e"]]),reaction:S,materialItem:j},onShow:function(){this.my_store=R(),this.getCartCountAndPrice(),this.getCartList()},setup(){const a=v(R()),o=v([]),i=v([]),n=v({}),c={pageSize:20,pageNum:1},r=v(0),u=v(0),d=v(!0),f=v(""),m=v([]),p=v([]);x({clf_inner_type:!0,clf_lay:1}).then((a=>{o.value=a.data}));const _=()=>{const a=((a,o)=>{for(var i in o||(o={}))e.call(o,i)&&l(a,i,o[i]);if(t)for(var i of t(o))s.call(o,i)&&l(a,i,o[i]);return a})({r_g_id:R().r_g_id,s_id:R().s_id},c);T(a).then((a=>{console.log(p.value);const t=a.data.map((a=>{const t=p.value.find((t=>t.m_id===a._id));return console.log(t),a.num=t?t.m_c_count:0,a}));t.length<c.pageSize&&(d.value=!1),i.value=[...i.value,...t],c.pageNum++,setTimeout((()=>{y()}),100)}))},g=v({show:!1,materials:[]}),h=()=>{O({s_id:R().s_id}).then((a=>{n.value=a.data}))},y=()=>{m.value=o.value.map((a=>{const t="classify_"+a._id;return document.getElementById(t),document.getElementById(t)&&document.getElementById(t).offsetTop})).filter((a=>a)),console.log(m.value)};return{classifyData:o,materialData:i,scrollClassifyIndex:r,countAndPrice:n,getCartCountAndPrice:h,toCartInsert:a=>{M(a).then((a=>{var t;h();const e=null==(t=a.data)?void 0:t.r_m_material;e&&e.length>0?g.value={materials:e,show:!0}:g.value={materials:[],show:!1}}))},reactionMaterials:g,scrollTop:u,getMaterialQuery:_,loading:d,page:c,classifyDomId:f,topList:m,setTopList:y,getCartList:()=>{L({s_id:R().s_id}).then((a=>{p.value=a.data||[],r.value=0,u.value=0,d.value=!0,f.value="",m.value=[],i.value=[],c.pageNum=1,_()}))},my_store:a}},methods:{classifyCheck(a,t){this.scrollClassifyIndex=t;const e=a._id,s="classify_"+e;if(document.getElementById(s))this.classifyDomId=s;else{const a=this.materialData[this.materialData.length-1],t=(null==a?void 0:a._id)||"",l={r_g_id:R().r_g_id,s_id:R().s_id,classifyId:e,lastMId:t,pageSize:this.page.pageSize};T(l).then((a=>{const t=a.data.map((a=>(a.num=0,a)));t.length<this.page.pageSize&&(this.loading=!1),this.materialData=[...this.materialData,...t],this.page.pageNum=++a.pageNum,setTimeout((()=>{this.classifyDomId=s,this.setTopList()}),100)}))}},lower:function(a){console.log(a),this.loading&&this.getMaterialQuery()},scroll:function(a){const t=a.detail.scrollTop+10,e=this.topList;let s=null;for(let l=0;l<e.length;l++){const a=l+1;if((l==e.length-1&&t>e[l]||t>e[l]&&t<=e[a])&&(s=l,this.scrollClassifyIndex=l),s)break}},toSearch(){C({url:"/pages/tabBar/subscribe/search"})}}}),[["render",function(a,t,e,s,l,o){const i=A,n=g,_=h,y=I("material-item"),v=k,C=I("reaction"),S=I("cart");return c(),r(_,{class:"shopping-container"},{default:u((()=>[d(_,{class:"shopping-container-title"},{default:u((()=>[d(_,{class:"left"},{default:u((()=>[d(i,{class:"logo",src:z}),d(n,null,{default:u((()=>[m(p(a.my_store.store_name),1)])),_:1})])),_:1}),d(_,{class:"right",onClick:a.toSearch},{default:u((()=>[f("span",{class:"icon iconfont icon-sousuo"}),m("搜索 ")])),_:1},8,["onClick"])])),_:1}),d(_,{class:"shopping-container-main"},{default:u((()=>[d(_,{class:"left classifyList"},{default:u((()=>[(c(!0),b(w,null,P(a.classifyData,((t,e)=>(c(),r(_,{class:D(a.scrollClassifyIndex===e?"openClassify classifyItem":"classifyItem"),onClick:s=>a.classifyCheck(t,e)},{default:u((()=>[d(_,null,{default:u((()=>[m(p(t.clf_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),256))])),_:1}),d(v,{ref:"materialMod",class:"right scroll-Y materialList","scroll-top":a.scrollTop,"scroll-y":"true","lower-threshold":"50","scroll-into-view":a.classifyDomId,onScrolltolower:a.lower,onScroll:a.scroll},{default:u((()=>[d(y,{materialData:a.materialData,onJiaReaction:a.toCartInsert,onJianReaction:a.getCartCountAndPrice},null,8,["materialData","onJiaReaction","onJianReaction"]),d(_,{class:"loading"},{default:u((()=>[m(p(a.loading?"加载中":"到底喽"),1)])),_:1})])),_:1},8,["scroll-top","scroll-into-view","onScrolltolower","onScroll"])])),_:1}),d(C,{reactionMaterials:a.reactionMaterials,onJiaReaction:a.toCartInsert},null,8,["reactionMaterials","onJiaReaction"]),d(S,{countAndPrice:a.countAndPrice},null,8,["countAndPrice"])])),_:1})}],["__scopeId","data-v-71cf9761"]]);export{J as default};
