var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{_ as s,z as l,A as c,H as d,I as p,Z as u,Y as f,R as h,o as g,d as m,w,e as y,f as v,h as b,k as O,a2 as P}from"./vendor.a21c6627.js";var x=s({data:()=>({title:"request-payment",loading:!1,price:1,providerList:[]}),onLoad:function(){},methods:{loginMpWeixin:()=>new Promise(((e,t)=>{l({provider:"weixin",success(n){console.warn("此处使用uni-id处理微信小程序登录，详情参考: https://uniapp.dcloud.net.cn/uniCloud/uni-id"),c({url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/user-center",method:"POST",data:{action:"loginByWeixin",params:{code:n.code,platform:"mp-weixin"}},success(n){0===n.data.code?(d("openid",n.data.openid),e(n.data.openid)):t(new Error("获取openid失败：",n.result.msg))},fail(e){t(new Error("获取openid失败："+e))}})},fail(e){t(e)}})})),async weixinPay(){let e=p("openid");if(console.log("发起支付"),this.loading=!0,!e){try{e=await this.loginMpWeixin()}catch(c){console.error(c)}if(!e)return u({content:"获取openid失败",showCancel:!1}),void(this.loading=!1)}this.openid=e;let s=await this.getOrderInfo("wxpay");var l;s?uni.requestPayment((l=((e,t)=>{for(var n in t||(t={}))a.call(t,n)&&r(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&r(e,n,t[n]);return e})({},s),t(l,n({success:e=>{f({title:"感谢您的赞助!"})},fail:e=>{u({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.loading=!1}})))):u({content:"获取支付信息失败",showCancel:!1})},async requestPayment(e,t){this.providerList[t].loading=!0;const n=e.id;let o=await this.getOrderInfo(n);o?(console.log("--------orderInfo--------"),console.log(o),uni.requestPayment({provider:n,orderInfo:o,success:e=>{console.log("success",e),f({title:"感谢您的赞助!"})},fail:e=>{console.log("fail",e),u({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.providerList[t].loading=!1}})):u({content:"获取支付信息失败",showCancel:!1})},getOrderInfo(e){return new Promise(((t,n)=>{this.price||n(new Error("请输入金额")),console.warn("此处使用uni-pay处理支付，详情参考: https://uniapp.dcloud.io/uniCloud/unipay"),c({method:"POST",url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/pay",data:{provider:e,openid:this.openid,totalFee:100*Number(this.price)},success(e){0===e.data.code?t(e.data.orderInfo):n(new Error("获取支付信息失败"+e.data.msg))},fail(e){n(new Error("请求支付接口失败"+e))}})}))},priceChange(e){console.log(e.detail.value),this.price=e.detail.value}}},[["render",function(e,t,n,o,a,i){const r=h("page-head"),s=b,l=O,c=P;return g(),m(l,null,{default:w((()=>[y(r,{title:a.title},null,8,["title"]),y(l,{class:"uni-padding-wrap"},{default:w((()=>[y(l,{style:{background:"#FFF",padding:"50rpx 0"}},{default:w((()=>[y(l,{class:"uni-hello-text uni-center"},{default:w((()=>[y(s,null,{default:w((()=>[v("支付金额")])),_:1})])),_:1}),y(l,{class:"uni-h1 uni-center uni-common-mt"},{default:w((()=>[y(s,{class:"rmbLogo"},{default:w((()=>[v("￥")])),_:1}),y(c,{class:"price",type:"digit",value:a.price,maxlength:"4",onInput:i.priceChange},null,8,["value","onInput"])])),_:1})])),_:1}),y(l,{class:"uni-btn-v uni-common-mt"})])),_:1})])),_:1})}],["__scopeId","data-v-730bdefe"]]);export{x as default};
