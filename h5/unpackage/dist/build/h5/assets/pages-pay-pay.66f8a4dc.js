import{_ as t,D as e,Z as a,E as c,Y as s,X as n,G as i,o as l,d as o,w as d,e as u,K as r,f as h,F as _,M as f,N as m,P as C,h as k,k as g,$ as p,a0 as b,T as v}from"./vendor.d63b4332.js";import{c as L,d as P,a as j}from"./subscribe.6867e227.js";import"./request.f2a0712f.js";import"./token.1631d279.js";var A=t(e({onShow:function(){a(),this.getCartList(),this.getCartCountAndPrice()},setup(){const t=c({}),e=c([]),a=c(!1),s=()=>{P({s_id:"10"}).then((e=>{t.value=e.data}))},n=()=>{j({s_id:"10"}).then((t=>{e.value=t.data}))};return{countAndPrice:t,cartMaterialList:e,toCartInsert:(t,e)=>{L(t).then((t=>{s(),e&&n()}))},getCartList:n,getCartCountAndPrice:s,cbChecked:a}},methods:{checkboxChange(t){var e=this.cartMaterialList,a=t.detail.value;e.map((t=>{a.includes(t.m_id)?this.$set(t,"checked",!0):this.$set(t,"checked",!1)}))},changeCb(){this.cbChecked=!this.cbChecked,this.setCheck()},setCheck(){this.cartMaterialList.map((t=>{this.$set(t,"checked",this.cbChecked)}))},dataChange(t){console.log(t),t._id,t.m_c_count,t.m_id},reduce(t,e=!1){t.m_c_count--;const a={m_id:t.m_id,m_c_count:-1,m_c_unit:1,s_id:"10"};this.toCartInsert(a,e)},jian(t){console.log("减少",t);const e=this;t.m_c_count<=1?s({content:"是否确认删除该物料",showCancel:!0,success:function(a){a.confirm&&e.reduce(t,!0)}}):e.reduce(t)},jia(t){t.m_c_count++;const e={m_id:t.m_id,m_c_count:1,m_c_unit:1,s_id:"10"};this.toCartInsert(e)},cartHandle(t){L(t).then((t=>{this.getCartCountAndPrice()}))},submit(){const t=this.cartMaterialList.filter((t=>t.checked));console.log(t),0!=t.length?i({url:"/pages/order/order",success:function(e){console.log("新的下订单"),e.eventChannel.emit("acceptDataFromOpenerPage",{data:{checkList:t}})}}):n({title:"您还没有选择物料哦",duration:2e3,icon:"none"})}}}),[["render",function(t,e,a,c,s,n){const i=k,L=g,P=p,j=b,A=v;return l(),o(L,{class:"shopping-container"},{default:d((()=>[u(L,{class:"title"},{default:d((()=>[u(L,{class:"left"},{default:d((()=>[r("span",{class:"icon iconfont icon-goumai"}),u(i,null,{default:d((()=>[h("购物车")])),_:1}),u(i,null,{default:d((()=>[h("("+_(t.countAndPrice.total||0)+")",1)])),_:1})])),_:1})])),_:1}),u(j,{onChange:t.checkboxChange,class:"commodityList"},{default:d((()=>[(l(!0),f(C,null,m(t.cartMaterialList,((t,e)=>(l(),o(L,{class:"commodityItem"},{default:d((()=>[u(P,{checked:t.checked,value:t.m_id},null,8,["checked","value"]),u(L,{class:"detail"},{default:d((()=>[u(i,{class:"left"},{default:d((()=>[u(i,null,{default:d((()=>[h("2021-12-01")])),_:1}),u(i,null,{default:d((()=>[h("提点管理费")])),_:1}),u(i,null,{default:d((()=>[h("￥528.00")])),_:1}),u(i,null,{default:d((()=>[h("查看")])),_:1})])),_:1}),u(i,{class:"right"},{default:d((()=>[r("span",{class:"icon iconfont icon-right"})])),_:1})])),_:1})])),_:2},1024)))),256))])),_:1},8,["onChange"]),u(L,{class:"account"},{default:d((()=>[u(L,{class:"left"},{default:d((()=>[u(P,{value:"cb",checked:t.cbChecked,onClick:t.changeCb},null,8,["checked","onClick"]),h("全选 ")])),_:1}),u(L,{class:"right"},{default:d((()=>[u(i,null,{default:d((()=>[h("总计:")])),_:1}),u(i,{class:"priceTotal"},{default:d((()=>[r("span",{class:"icon iconfont icon-jine"}),h(_(t.countAndPrice.price||0),1)])),_:1}),u(A,{type:"primary",size:"mini",onClick:t.submit},{default:d((()=>[h("去下单")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-864ee738"]]);export{A as default};
